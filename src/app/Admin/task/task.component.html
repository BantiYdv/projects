
<div class="container">
    <div class="row">
        <div class="col-12 col-md-12 d-flex flex-wrap justify-content-around mt-5">
            <div class="col-12 col-md-6 ">
                <div class="header_css_added_project">
                    Added Task
                </div>
            </div>
            <div class="col-12 col-md-6 ">
                <div class="header_css_button_project">
                    <button data-bs-toggle="modal" data-bs-target="#addNewTask"><i class="fa fa-plus"></i> Add New</button>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-12 col-md-12 mt-3 overflow-auto">
            <table class="table tAble_css">
                <thead class="table-dark tHead_css">
                    <tr>
                        <th scope="col">Project Name</th>
                        <th scope="col">Task No.</th>
                        <th scope="col">Name</th>
                        <th scope="col">Assign To</th>
                        <th scope="col">Download</th>
                        <th scope="col">Status</th>
                        <th scope="col">Edit</th>
                      </tr>
                </thead>
                <tbody class="tBody_css">
                    <tr *ngFor="let task of tasks;">
                        <td scope="row" [ngClass]="{ 'bg-secondary': !task.task_info.is_enabled }">{{ task.task_info.project_name  || "-" }}</td>
                        <td [ngClass]="{ 'bg-secondary': !task.task_info.is_enabled }">{{ task.task_info.task_number  || "-" }}</td>
                        <td [ngClass]="{ 'bg-secondary': !task.task_info.is_enabled }">{{ task.task_info.name  || "-" }}</td>
                        <td [ngClass]="{ 'bg-secondary': !task.task_info.is_enabled }">{{ task.task_info.assgined_team_member  || "-" }}</td>
                        <!-- <td>{{ task.handledBy }}</td> -->
                        <td [ngClass]="{ 'bg-secondary': !task.task_info.is_enabled }">
                            <div  data-bs-toggle="modal" (click)="getTaskById(task.task_info._id)"
                            data-bs-target="#downloadTask">
                            <img src="../../../assets/images/download_css_ing.svg" class="w-25" alt="">
                        </div>
                    </td>
                        <td [ngClass]="{ 'bg-secondary': !task.task_info.is_enabled }">
                          <select class="select_css_code" [(ngModel)]="task.task_info.current_status" name="current_status" (change)="onChangeStatus(task.task_info._id,task.task_info.current_status)">
                            <option value="Created">Created</option>
                                <option value="Start">Start</option>
                                <option value="Ongoing">Ongoing</option>
                                <option value="Finished">Finished</option>
                          </select>
                        </td>
                        <td [ngClass]="{ 'bg-secondary': !task.task_info.is_enabled }">
                          <div class="icon_t_e_e">
                            <i class="fas fa-trash-restore-alt" *ngIf="!task.task_info.is_enabled" (click)="deleteTask(task.task_info._id,task.task_info.is_enabled)"></i>
                            <i class="fa fa-trash" *ngIf="task.task_info.is_enabled" (click)="deleteTask(task.task_info._id,task.task_info.is_enabled)"></i>
                            <i class="fa fa-edit" *ngIf="task.task_info.is_enabled" (click)="getTaskById(task.task_info._id)"  data-bs-toggle="modal" data-bs-target="#updateNewTask"></i>
                            <i class="fa fa-eye"  (click)="getTaskById(task.task_info._id)" data-bs-toggle="modal" data-bs-target="#viewNewTask"></i>
                          </div>
                        </td>
                      </tr>
                </tbody>
              </table>
        </div>
    </div>
</div>


  
  <!-- Modal addNewTask -->
  <div class="modal fade" id="addNewTask" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header" style="background-color: #3B3A70;">
            <div class="col-12 col-md-12 d-flex flex-nowrap">
                <div class="col-11 col-md-11 text_add_p_css"><div class="modal-title fs-5" id="exampleModalLabel">Add Task</div></div>
                <div class="col-1 col-md-1 text-end text-white"><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div>
            </div>
        </div>
        <div class="modal-body m-4">
            <form #saveTaskForm="ngForm" (ngSubmit)="saveTask(taskSave)">
          <div class="col-12 col-md-12 d-flex flex-wrap">
            <div class="col-12 col-md-6">
                <div class="add_css_pro_code">
                    <label>Select Project</label>
                    <select [(ngModel)]="taskSave.project_id" name="project_id">
                        <option disabled value="">Select Project</option>
                        <option *ngFor="let project of projectList" [value]="project._id">{{project.name}}</option>
                    </select>
                </div>
            </div>
            <div class="col-12 col-md-6">
                <div class="add_css_pro_code">
                    <label>Task Name</label>
                    <input type="text" placeholder="Task Name" [(ngModel)]="taskSave.name" name="name" required>
                </div>
            </div>
            <div class="col-12 col-md-6">
                <div class="add_css_pro_code">
                    <label>Assign To Team Member</label>
                    <select [(ngModel)]="taskSave.assgined_to" name="assgined_to" required>
                        <option disabled value="">Select Member</option>
                        <option *ngFor="let handel of handel_By" [value]="handel._id">{{handel.name}}</option>
                    </select>
                </div>
            </div>
            <div class="col-12 col-md-6">
                <div class="add_css_pro_code">
                    <label>Upload Doc.</label>
                    <input type="file" (change)="onChangeProjectSave($event)" [(ngModel)]="taskSave.task_attachement" name="task_attachement">
                </div>
            </div>
            <div class="col-12 col-md-6">
                <div class="add_css_pro_code">
                    <label>Start Date</label>
                    <input type="date" [(ngModel)]="taskSave.start_date" [min]="currentDate" name="start_date" required>
                </div>
            </div>
            <div class="col-12 col-md-6">
                <div class="add_css_pro_code">
                    <label>Deadline Date</label>
                    <input type="date" [(ngModel)]="taskSave.deadline" [min]="taskSave.start_date || currentDate " name="deadline" required>
                </div>
            </div>
            <div class="col-12 col-md-12">
                <div class="add_css_pro_code">
                    <label>Other Information</label>
                    <input type="text" placeholder="other information"  [(ngModel)]="taskSave.desc" name="desc">
                </div>
            </div>
          </div>
          <div class="col-12 col-md-12">
            <div class="save_css_button_code">
                <button  [disabled]="saveTaskForm.invalid">Save</button>
            </div>
          </div>
          </form>

        </div>
      </div>
    </div>
  </div>


   <!-- Modal updateNewTask -->
   <div class="modal fade" id="updateNewTask" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header" style="background-color: #3B3A70;">
            <div class="col-12 col-md-12 d-flex flex-nowrap">
                <div class="col-11 col-md-11 text_add_p_css"><div class="modal-title fs-5" id="exampleModalLabel">Update {{taskUpdate.name}} Task</div></div>
                <div class="col-1 col-md-1 text-end text-white"><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div>
            </div>
        </div>
        <div class="modal-body m-4">
            <form #updateTaskForm="ngForm" (ngSubmit)="updateTask(taskUpdate)">
                <div class="col-12 col-md-12 d-flex flex-wrap">
                    <div class="col-12 col-md-6">
                        <div class="add_css_pro_code">
                            <label>Select Project</label>
                            <select [(ngModel)]="taskUpdate.project_id" name="project_id">
                                <option disabled value="">Select Project</option>
                                <option *ngFor="let project of projectList" [value]="project._id">{{project.name}}</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-12 col-md-6">
                        <div class="add_css_pro_code">
                            <label>Task Name</label>
                            <input type="text" placeholder="Task Name" [(ngModel)]="taskUpdate.name" name="name" required>
                        </div>
                    </div>
                    <div class="col-12 col-md-6">
                        <div class="add_css_pro_code">
                            <label>Assign To Team Member</label>
                            <select [(ngModel)]="taskUpdate.assgined_to" name="assgined_to" required>
                                <option disabled value="">Select Member</option>
                                <option *ngFor="let handel of handel_By" [value]="handel._id">{{handel.name}}</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-12 col-md-6">
                        <div class="add_css_pro_code">
                            <label>Upload Doc.</label>
                            <input type="file" (change)="onChangeProjectSave($event)" [(ngModel)]="taskUpdate.task_attachement" name="task_attachement">
                        </div>
                    </div>
                    <div class="col-12 col-md-6">
                        <div class="add_css_pro_code">
                            <label>Start Date</label>
                            <input type="date" [(ngModel)]="taskUpdate.start_date" [min]="currentDate" name="start_date" required>
                        </div>
                    </div>
                    <div class="col-12 col-md-6">
                        <div class="add_css_pro_code">
                            <label>Deadline Date</label>
                            <input type="date" [(ngModel)]="taskUpdate.deadline" [min]="taskUpdate.start_date  || currentDate" name="deadline" required>
                        </div>
                    </div>
                    <div class="col-12 col-md-12">
                        <div class="add_css_pro_code">
                            <label>Other Information</label>
                            <input type="text" placeholder="other information"  [(ngModel)]="taskUpdate.desc" name="desc">
                        </div>
                    </div>
                  </div>
          <div class="col-12 col-md-12">
            <div class="save_css_button_code">
                <button [disabled]="updateTaskForm.invalid">Update</button>
            </div>
          </div>
        </form>
        </div>
      </div>
    </div>
  </div>


  
   <!-- Modal ViewNewProject -->
   <div class="modal fade" id="viewNewTask" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header" style="background-color: #3B3A70;">
            <div class="col-12 col-md-12 d-flex flex-nowrap">
                <div class="col-11 col-md-11 text_add_p_css"><div class="modal-title fs-5" id="exampleModalLabel">{{taskUpdate.name || 'Task'}} Details</div></div>
                <div class="col-1 col-md-1 text-end text-white"><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div>
            </div>
        </div>
        <div class="modal-body m-4">
          <div class="col-12 col-md-12 d-flex flex-wrap">
            <div class="col-12 col-md-6">
                <div class="add_css_pro_code">
                    <label>Project Name</label>
                    <span>{{taskUpdate.project_name}}</span>
                </div>
            </div>
            
            <div class="col-12 col-md-6">
                <div class="add_css_pro_code">
                    <label>Task No.</label>
                    <span>{{taskUpdate.task_number}}</span>
                </div>
            </div>
            <div class="col-12 col-md-6">
                <div class="add_css_pro_code">
                    <label>Task Name</label>
                    <span>{{taskUpdate.name}}</span>
                </div>
            </div>
            <div class="col-12 col-md-6">
                <div class="add_css_pro_code">
                    <label>Assign To Team Member</label>
                    <span>{{taskUpdate.assgined_to}}</span>
                </div>
            </div>
            <div class="col-12 col-md-6">
                <div class="add_css_pro_code">
                    <label>Upload Doc.</label>
                    <span *ngFor="let attachment of taskUpdate.attachment , let i = index">
                        {{attachment.name || 'Document'}}</span>
                        <div *ngIf="taskUpdate.attachment == 0" class="d-flex">
                            No Document
                        </div>
                </div>
            </div>
            <div class="col-12 col-md-6">
                <div class="add_css_pro_code">
                    <label>Description</label>
                    <span>{{taskUpdate.desc}}</span>
                </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>



  <div class="modal fade" id="downloadTask" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header" style="background-color: #3B3A70;">
                <div class="col-12 col-md-12 d-flex flex-nowrap">
                    <div class="col-11 col-md-11 text_add_p_css">
                        <div class="modal-title fs-5" id="exampleModalLabel">{{taskUpdate.name || 'Task'}} Details</div>
                    </div>
                    <div class="col-1 col-md-1 text-end text-white"><button type="button" class="btn-close"
                            data-bs-dismiss="modal" aria-label="Close"></button></div>
                </div>
            </div>
            <div class="modal-body m-4">
                <div class="col-12 col-md-12">
                    <div  *ngFor="let attachment of taskUpdate.attachment , let i = index" class="d-flex justify-content-between align-items-center" >
                        <h2>{{attachment.name}}</h2>
                        <a href="'http://101.53.145.234:4005/' + taskUpdate.attachment.url" download>
                            <img src="../../../assets/images/download_css_ing.svg" class="w-25" alt="">
                        </a>
                    </div>
                    <div *ngIf="taskUpdate.attachment == 0" class="d-flex justify-content-center align-items-center">
                        No Document
                    </div>
                    <div *ngIf="!taskUpdate.attachment" class="d-flex justify-content-center align-items-center">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                          </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>






















